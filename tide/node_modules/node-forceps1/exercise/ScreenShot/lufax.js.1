Date.prototype.Format = function(fmt)   
{ //author: meizz   
  var o = {   
    "M+" : this.getMonth()+1,                 //Ô·Ý  
    "d+" : this.getDate(),                    //È   
    "h+" : this.getHours(),                   //Сʱ   
    "m+" : this.getMinutes(),                 //·Ö  
    "s+" : this.getSeconds(),                 //Ã   
    "q+" : Math.floor((this.getMonth()+3)/3), //¼¾¶È  
    "S"  : this.getMilliseconds()             //ºÁë 
  };   
  if(/(y+)/.test(fmt))   
    fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));   
  for(var k in o)   
    if(new RegExp("("+ k +")").test(fmt))   
  fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));   
  return fmt;   
}  
var lufaxPageList = {
		loginInfo : function(request) {
		},
		pageList1 : [
			{
				name:"myAccount",
				url:"https://my.lufax.com/my/account"
				//url:"https://www.lufax.com"
			}
			
		],
		pageList2 : []
	};
phantom.outputEncoding="utf8";	
var webpage = require("webpage");
var page = webpage.create();

page.viewportSize = {
	width: 1100,
  height: 2000
};
page.customHeaders = {
//	'Accept-Charset':'GBK,utf-8;q=0.7,*;q=0.3',
	'Cookie':'_lufaxSID="baea3378-bdfd-49dc-806a-4b7a8b875539,VQ2OuSBKiPBeWmXAwHfxqXQ4euhXgDmUWX4L7Ser5QNlq4yB0n4NJedQxiLUxXb/RpCGxAm3CuV8YHfySUN9yg=="'
}
var path = 'test';
var suffix = new Date().Format("yyyyMMddhhmmss")
var saveUrlToPicture = function(pictureName, url, index) {
	console.log("the picture name is : [" + pictureName + "] --> [" + url + "]");
	console.log("start to open the url : " + url);
	page.open(url,function(status) {
		console.log('open url success');
		page.render("/lufaxMonitor/"+ path + "/lufax/" + pictureName + "_" + suffix + ".png" );
		console.log("/lufaxMonitor/"+ path + "/lufax/" + pictureName + "_" + suffix + ".png" );
		for(var e in page) {
			console.log(e + '--->' + page[e]);
			console.log('-----------------------------------------------');
		}
		console.log(page.cookies);
   		if(index < lufaxPageList.pageList1.length -1) {
			var nextPicture = lufaxPageList.pageList1[index+1].name;
			var nextUrl = lufaxPageList.pageList1[index+1].url;
       			saveUrlToPicture.apply(null,[nextPicture, nextUrl, index+1] );
     		}else {
     			return phantom.exit();	
     		}
	});
} 
saveUrlToPicture(lufaxPageList.pageList1[0].name, lufaxPageList.pageList1[0].url, 0);



